<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="vue3, 前端">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>vue3 | CheapCoder</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.1.1"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <span class="logo-span">CheapCoder</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <div class="logo-name">CheapCoder</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/necessityOVO/necessityOVO.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/necessityOVO/necessityOVO.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/21.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">vue3</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/vue3/">
                                <span class="chip bg-color">vue3</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-07-19
                </div>
                

                

                

                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>源地址：<a target="_blank" rel="noopener" href="https://24kcs.github.io/vue3_study/00_%E8%AF%BE%E7%A8%8B%E4%BB%8B%E7%BB%8D.html">https://24kcs.github.io/vue3_study/00_%E8%AF%BE%E7%A8%8B%E4%BB%8B%E7%BB%8D.html</a></p>
<h1 id="1-认识Vue3"><a href="#1-认识Vue3" class="headerlink" title="1. 认识Vue3"></a>1. 认识Vue3</h1><h2 id="特点："><a href="#特点：" class="headerlink" title="特点："></a>特点：</h2><ul>
<li>打包大小减少41%,初次渲染快55%, 更新渲染快133%,内存减少54%</li>
<li><strong>支持vue2的大多数特性</strong></li>
<li><strong>更好的支持Typescript</strong></li>
<li><strong>使用<code>Proxy</code>代替<code>defineProperty</code>实现数据响应式</strong></li>
<li><strong>重写虚拟DOM的实现和Tree-Shaking</strong></li>
</ul>
<h2 id="新增特性"><a href="#新增特性" class="headerlink" title="新增特性"></a>新增特性</h2><ul>
<li><strong>Composition (组合) API</strong><ul>
<li>setup</li>
<li>ref 和 reactive</li>
<li>computed、watch、watchEffect</li>
<li>新的生命周期函数</li>
<li>provide与inject</li>
</ul>
</li>
<li>新组件<ul>
<li>Fragment - 文档碎片</li>
<li>Teleport - 瞬移组件的位置</li>
<li>Suspense - 异步加载组件的loading界面</li>
</ul>
</li>
<li>其它API更新<ul>
<li>全局API的修改</li>
<li>将原来的全局API转移到应用对象(App)</li>
<li>模板语法变化</li>
</ul>
</li>
</ul>
<h1 id="2-创建vue3项目"><a href="#2-创建vue3项目" class="headerlink" title="2. 创建vue3项目"></a>2. 创建vue3项目</h1><h2 id="1-使用-vue-cli-创建"><a href="#1-使用-vue-cli-创建" class="headerlink" title="1) 使用 vue-cli 创建"></a>1) 使用 vue-cli 创建</h2><p>文档: <a target="_blank" rel="noopener" href="https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create">https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create</a></p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">## 安装或者升级</span>
<span class="token function">npm</span> <span class="token function">install</span> -g @vue/cli
<span class="token comment" spellcheck="true">## 保证 vue cli 版本在 4.5.0 以上</span>
vue --version
<span class="token comment" spellcheck="true">## 创建项目</span>
vue create my-project</code></pre>
<p>步骤：</p>
<pre><code>- Please pick a preset - 选择 ***Manually select features***
- Check the features needed for your project - 选择上 ***TypeScript*** ，特别注意点空格是选择，点回车是下一步
- Choose a version of Vue.js that you want to start the project with - 选择 ***3.x (Preview)***
- Use class-style component syntax - 直接回车
- Use Babel alongside TypeScript - 直接回车
- Pick a linter / formatter config - 直接回车
- Use history mode for router? - 直接回车
- Pick a linter / formatter config - 直接回车
- Pick additional lint features - 直接回车
- Where do you prefer placing config for Babel, ESLint, etc.? - 直接回车
- Save this as a preset for future projects? - 直接回车</code></pre>
<h2 id="2-使用-vite-创建"><a href="#2-使用-vite-创建" class="headerlink" title="2) 使用 vite 创建"></a>2) 使用 vite 创建</h2><p>文档: <a target="_blank" rel="noopener" href="https://v3.cn.vuejs.org/guide/installation.html">https://v3.cn.vuejs.org/guide/installation.html</a></p>
<ul>
<li>vite 是一个由原生 ESM 驱动的 Web 开发构建工具。在开发环境下基于浏览器原生 ES imports 开发，</li>
<li>它做到了**<em>本地快速开发启动**</em>, 在生产环境下基于 Rollup 打包。<ul>
<li>快速的冷启动，不需要等待打包操作；</li>
<li>即时的热模块更新，替换性能和模块数量的解耦让更新飞起；</li>
<li>真正的按需编译，不再等待整个应用编译完成，这是一个巨大的改变。</li>
</ul>
</li>
</ul>
<pre class=" language-bash"><code class="language-bash"><span class="token function">npm</span> init vite-app <span class="token operator">&lt;</span>project-name<span class="token operator">></span>
<span class="token function">cd</span> <span class="token operator">&lt;</span>project-name<span class="token operator">></span>
<span class="token function">npm</span> <span class="token function">install</span>
<span class="token function">npm</span> run dev</code></pre>
<h1 id="3-Vue2与Vue3的响应式原理比较-重要"><a href="#3-Vue2与Vue3的响应式原理比较-重要" class="headerlink" title="3. Vue2与Vue3的响应式原理比较(重要)"></a>3. Vue2与Vue3的响应式原理比较(重要)</h1><h3 id="1-Vue2的响应式"><a href="#1-Vue2的响应式" class="headerlink" title="1) Vue2的响应式"></a>1) Vue2的响应式</h3><ul>
<li>核心:<ul>
<li>对象: 通过<code>defineProperty</code>对对象的已有属性值的读取和修改进行劫持(监视/拦截)</li>
<li>数组: 通过重写数组更新数组一系列更新元素的方法来实现元素修改的劫持（push、pop、shift、unshift、splice、sort、reverse）</li>
</ul>
</li>
</ul>
<pre class=" language-js"><code class="language-js">Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 
    <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<ul>
<li>问题<ul>
<li>对象直接新添加的属性或删除已有属性, 界面不会自动更新</li>
<li>直接通过下标替换元素或更新length（arr[1] = {}）, 界面不会自动更新 </li>
</ul>
</li>
</ul>
<h3 id="2-Vue3的响应式"><a href="#2-Vue3的响应式" class="headerlink" title="2) Vue3的响应式"></a>2) Vue3的响应式</h3><ul>
<li>核心:<ul>
<li>通过<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy(代理)</a>: 拦截对data任意属性的任意(13种)操作, 包括属性值的读写, 添加, 删除等</li>
<li>通过 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect">Reflect(反射)</a>: <strong>动态</strong>对被代理对象的相应属性进行特定的操作</li>
</ul>
</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">"John"</span><span class="token punctuation">,</span>
  age<span class="token punctuation">:</span> <span class="token number">12</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/* 
proxyUser是代理对象, user是被代理对象
后面所有的操作都是通过代理对象来操作被代理对象内部属性
*/</span>
<span class="token keyword">const</span> proxyUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token punctuation">{</span>

  <span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'劫持get()'</span><span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token keyword">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'劫持set()'</span><span class="token punctuation">,</span> prop<span class="token punctuation">,</span> val<span class="token punctuation">)</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// (2)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">deleteProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'劫持delete属性'</span><span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">deleteProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 读取属性值</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxyUser <span class="token operator">===</span> user<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxyUser<span class="token punctuation">.</span>name<span class="token punctuation">,</span> proxyUser<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// 设置属性值</span>
proxyUser<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'bob'</span>
proxyUser<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">13</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// 添加属性</span>
proxyUser<span class="token punctuation">.</span>sex <span class="token operator">=</span> <span class="token string">'男'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// 删除属性</span>
<span class="token keyword">delete</span> proxyUser<span class="token punctuation">.</span>sex
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span></code></pre>
<h1 id="4-Composition-API-常用部分"><a href="#4-Composition-API-常用部分" class="headerlink" title="4. Composition API(常用部分)"></a>4. Composition API(常用部分)</h1><p>文档: <a target="_blank" rel="noopener" href="https://composition-api.vuejs.org/zh/api.html">https://composition-api.vuejs.org/zh/api.html</a></p>
<h2 id="1-setup"><a href="#1-setup" class="headerlink" title="1) setup"></a>1) setup</h2><ul>
<li>setup执行<ul>
<li>在<code>beforeCreate</code>之前执行(一次), 此时组件对象还没有创建</li>
<li>this是undefined, 不能通过this来访问data/computed/methods / props</li>
</ul>
</li>
<li>setup的返回值<ul>
<li>一般都返回一个对象为模板提供数据, 也就是模板中可以直接使用此对象中的所有属性/方法</li>
<li>返回对象中的属性、方法会与data函数、methods中的合并</li>
<li>如果<strong>有重名, setup优先</strong>，一般不要混合使用，来源混乱</li>
<li>methods中可以访问setup提供的属性和方法, 但在setup方法中不能访问data和methods</li>
<li>setup不能是一个async函数: 因为返回值不再是对象, 而是promise, 模板看不到return对象中的属性数据（可变成异步组件）</li>
</ul>
</li>
<li>setup的参数：(props, context) / setup(props, {attrs, slots, emit})<ul>
<li><code>props</code>: 包含props配置声明且传入了的所有属性的对象</li>
<li><code>attrs</code>: 包含没有在props配置中声明的属性的对象, 相当于 <code>this.$attrs</code></li>
<li><code>slots</code>: 包含所有传入的插槽内容的对象, 相当于 <code>this.$slots</code></li>
<li><code>emit</code>: 用来分发自定义事件的函数, 相当于 <code>this.$emit</code></li>
</ul>
</li>
</ul>
<pre class=" language-vue"><code class="language-vue">// 父组件
<template>
  <h2>App</h2>
  <p>msg: {{msg}}</p>
  <button @click="fn('--')">更新</button>

  <child :msg="msg" msg2="cba" @fn="fn"/>
</template>

<script lang="ts">
import {
  reactive,
  ref,
} from 'vue'
import child from './child.vue'

export default {

  components: {
    child
  },

  setup () {
    const msg = ref('abc')

    function fn (content: string) {
      msg.value += content
    }
    return {
      msg,
      fn
    }
  }
}
</script>

// 子组件
<template>
  <div>
    <h3>{{n}}</h3>
    <h3>{{m}}</h3>

    <h3>msg: {{msg}}</h3>
    <h3>msg2: {{$attrs.msg2}}</h3>

    <slot name="xxx"></slot>

    <button @click="update">更新</button>
  </div>
</template>

<script lang="ts">
import {
  ref,
  defineComponent
} from 'vue'

export default defineComponent({
  name: 'child',

  props: ['msg'],

  emits: ['fn'], // 可选的, 声明了更利于程序员阅读, 且可以对分发的事件数据进行校验

  data () {
    console.log('data', this)
    return {
      // n: 1
    }
  },

  beforeCreate () {
    console.log('beforeCreate', this)
  },

  methods: {
    // update () {
    //   this.n++
    //   this.m++
    // }
  },

  // setup (props, context) {
  setup (props, {attrs, emit, slots}) {

    console.log('setup', this)
    console.log(props.msg, attrs.msg2, slots, emit)

    const m = ref(2)
    const n = ref(3)

    function update () {
      // console.log('--', this)
      // this.n += 2 
      // this.m += 2

      m.value += 2
      n.value += 2

      // 分发自定义事件
      emit('fn', '++')
    }

    return {
      m,
      n,
      update,
    }
  },
})
</script></code></pre>
<h2 id="2-ref"><a href="#2-ref" class="headerlink" title="2) ref"></a>2) ref</h2><ul>
<li>作用: 通常定义一个<strong>基本类型</strong>的响应式数据</li>
<li>语法： <code>const xxx = ref(initValue)</code><ul>
<li>创建一个包含响应式数据的引用(reference)对象</li>
<li>js中操作数据: xxx.value</li>
<li>模板中操作数据: 不需要.value</li>
</ul>
</li>
</ul>
<pre class=" language-vue"><code class="language-vue"><template>
  <h2>{{count}}</h2>
  <hr>
  <button @click="update">更新</button>
</template>

<script>
import {
  ref
} from 'vue'
export default {

  /* 在Vue3中依然可以使用data和methods配置, 但建议使用其新语法实现 */
  // data () {
  //   return {
  //     count: 0
  //   }
  // },
  // methods: {
  //   update () {
  //     this.count++
  //   }
  // }

  /* 使用vue3的composition API */
  setup () {

    // 定义响应式数据 ref对象
    const count = ref(1)
    console.log(count)

    // 更新响应式数据的函数
    function update () {
      // alert('update')
      count.value = count.value + 1
    }

    return {
      count,
      update
    }
  }
}
</script></code></pre>
<p><strong>利用ref函数获取组件中的标签元素</strong></p>
<pre class=" language-vue"><code class="language-vue">// 功能需求: 让输入框自动获取焦点
<template>
  <h2>App</h2>
  <input type="text">---
  <input type="text" ref="inputRef">
</template>

<script lang="ts">
import { onMounted, ref } from 'vue'
/* 
ref获取元素: 利用ref函数获取组件中的标签元素
功能需求: 让输入框自动获取焦点
*/
export default {
  setup() {
    const inputRef = ref<HTMLElement|null>(null)    // 定义ref变量

    onMounted(() => {
      inputRef.value && inputRef.value.focus()    // 可直接使用ref变量访问
    })

    return {
      inputRef
    }
  },
}
</script></code></pre>
<h2 id="3-reactive"><a href="#3-reactive" class="headerlink" title="3) reactive"></a>3) reactive</h2><ul>
<li>作用: 定义<strong>复杂数据类型</strong>的响应式代理</li>
<li>语法：<code>const proxy = reactive(obj)</code><ul>
<li>接收一个普通对象然后返回该普通对象的响应式代理器对象</li>
<li>响应式转换是“深层的”：会影响对象内部所有嵌套的属性</li>
<li>内部基于 ES6 的 Proxy 实现，通过代理对象操作源对象内部数据都是响应式的</li>
</ul>
</li>
</ul>
<pre class=" language-vue"><code class="language-vue"><template>  <h2>name: {{state.name}}</h2>  <h2>age: {{state.age}}</h2>  <h2>wife: {{state.wife}}</h2>  <hr>  <button @click="update">更新</button></template><script>import {  reactive,} from 'vue'export default {  setup () {    /*     定义响应式数据对象    */    const state = reactive({      name: 'tom',      age: 25,      wife: {        name: 'marry',        age: 22      },    })    console.log(state, state.wife)    const update = () => {      state.name += '--'      state.age += 1      state.wife.name += '++'      state.wife.age += 2    }    return {      state,      update,    }  }}</script></code></pre>
<h2 id="4-reactive与ref-细节"><a href="#4-reactive与ref-细节" class="headerlink" title="4) reactive与ref-细节"></a>4) reactive与ref-细节</h2><ul>
<li>ref用来处理<strong>基本类型</strong>数据, reactive用来处理<strong>对象</strong>(递归深度响应式)</li>
<li>如果用ref对象/数组, 内部会自动将xxx.value的对象/数组转换为reactive的代理对象</li>
<li>ref内部: 通过给<strong>value属性添加getter/setter</strong>来实现对数据的劫持</li>
<li>reactive内部: 通过使用Proxy来实现对对象内部所有数据的劫持, 并通过Reflect操作对象内部数据</li>
<li>ref的数据操作: 在js中要.value, 在模板中不需要(内部解析模板时会自动添加.value)</li>
</ul>
<pre class=" language-vue"><code class="language-vue"><template>  <h2>App</h2>  <p>m1: {{m1}}</p>  <p>m2: {{m2}}</p>  <p>m3: {{m3}}</p>  <button @click="update">更新</button></template><script lang="ts">import {  reactive,  ref} from 'vue'export default {  setup () {    const m1 = ref('abc')    const m2 = reactive({x: 1, y: {z: 'abc'}})    // 使用ref处理对象  ==> 对象会被自动reactive为proxy对象    const m3 = ref({a1: 2, a2: {a3: 'abc'}})    console.log(m1, m2, m3)    console.log(m3.value.a2) // 也是一个proxy对象    function update() {      m1.value += '--'      m2.x += 1      m2.y.z += '++'      m3.value = {a1: 3, a2: {a3: 'abc---'}}      m3.value.a2.a3 += '==' // reactive对对象进行了深度数据劫持      console.log(m3.value.a2)    }    return {      m1,      m2,      m3,      update    }  }}</script></code></pre>
<h2 id="5-computed和watch"><a href="#5-computed和watch" class="headerlink" title="5) computed和watch"></a>5) computed和watch</h2><ul>
<li>computed函数:<ul>
<li>与vue2的computed配置功能一致</li>
<li>有getter和setter</li>
</ul>
</li>
<li>watch函数<ul>
<li>监视指定的一个或多个响应式数据, 一旦数据变化, 就自动执行监视回调</li>
<li>默认初始时不执行回调, 但可以通过配置<code>immediate</code>为true, 来指定初始时立即执行第一次</li>
<li>通过配置<code>deep</code>为true, 来指定深度监视</li>
<li>如果是ref对象, 直接指定；是reactive对象中的属性,  必须通过函数来指定</li>
</ul>
</li>
<li>watchEffect函数<ul>
<li>不用直接指定要监视的数据, 自动监视内部响应式数据，发生变化时回调执行</li>
<li>默认初始时就会执行第一次, 从而可以收集需要监视的数据</li>
</ul>
</li>
</ul>
<pre class=" language-vue"><code class="language-vue"><template>  <h2>App</h2>  fistName: <input v-model="user.firstName"/><br>  lastName: <input v-model="user.lastName"/><br>  fullName1: <input v-model="fullName1"/><br>  fullName2: <input v-model="fullName2"><br>  fullName3: <input v-model="fullName3"><br></template><script lang="ts">import {  reactive,  ref,  computed,  watch,  watchEffect} from 'vue'export default {  setup () {    const user = reactive({      firstName: 'A',      lastName: 'B'    })    // 只有getter的计算属性    const fullName1 = computed(() => {      console.log('fullName1')      return user.firstName + '-' + user.lastName    })    // 有getter与setter的计算属性    const fullName2 = computed({      get () {        console.log('fullName2 get')        return user.firstName + '-' + user.lastName      },      set (value: string) {        console.log('fullName2 set')        const names = value.split('-')        user.firstName = names[0]        user.lastName = names[1]      }    })    const fullName3 = ref('')    /*     watchEffect: 监视所有回调中使用的数据    */    /*     watchEffect(() => {      console.log('watchEffect')      fullName3.value = user.firstName + '-' + user.lastName    })     */    /*     使用watch的2个特性:      深度监视      初始化立即执行    */    watch(user, () => {      fullName3.value = user.firstName + '-' + user.lastName    }, {      immediate: true,  // 是否初始化立即执行一次, 默认是false      deep: true, // 是否是深度监视, 默认是false    })    /*     watch一个数据      默认在数据发生改变时执行回调    */    watch(fullName3, (value) => {      console.log('watch')      const names = value.split('-')      user.firstName = names[0]      user.lastName = names[1]    })    /*     watch多个数据，使用数组来指定              如果是ref对象, 直接指定              如果是reactive对象中的属性,  必须通过函数来指定    */    watch([() => user.firstName, () => user.lastName, fullName3], (values) => {      console.log('监视多个数据', values)    })    return {      user,      fullName1,      fullName2,      fullName3    }  }}</script></code></pre>
<h2 id="6-生命周期"><a href="#6-生命周期" class="headerlink" title="6) 生命周期"></a>6) 生命周期</h2><table>
<thead>
<tr>
<th align="center"><strong>vue2.x的生命周期</strong>：</th>
<th align="center">vue3的生命周期：</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="./pic/loading.gif" data-original="https://cn.vuejs.org/images/lifecycle.png" alt="lifecycle_2" style="zoom:33%;"></td>
<td align="center"><img src="./pic/loading.gif" data-original="https://vue3js.cn/docs/zh/images/lifecycle.png" alt="lifecycle_3" style="zoom: 33%;"></td>
</tr>
</tbody></table>
<p><strong>与 2.x 版本生命周期相对应的组合式 API</strong></p>
<ul>
<li><code>beforeCreate</code> -&gt; 使用 <code>setup()</code></li>
<li><code>created</code> -&gt; 使用 <code>setup()</code></li>
<li><code>beforeMount</code> -&gt; <code>onBeforeMount</code></li>
<li><code>mounted</code> -&gt; <code>onMounted</code></li>
<li><code>beforeUpdate</code> -&gt; <code>onBeforeUpdate</code></li>
<li><code>updated</code> -&gt; <code>onUpdated</code></li>
<li><code>beforeDestroy</code> -&gt; <code>onBeforeUnmount</code>    // 名称修改</li>
<li><code>destroyed</code> -&gt; <code>onUnmounted</code></li>
<li><code>errorCaptured</code> -&gt; <code>onErrorCaptured</code></li>
</ul>
<blockquote>
<p>而且两种生命周期函数同时存在时，3.0的onXXX函数优先执行</p>
</blockquote>
<p><strong>新增的钩子函数</strong></p>
<p>组合式 API 还提供了以下调试钩子函数：</p>
<ul>
<li><code>onRenderTracked</code></li>
<li><code>onRenderTriggered</code></li>
</ul>
<pre class=" language-vue"><code class="language-vue"><template><div class="about">  <h2>msg: {{msg}}</h2>  <hr>  <button @click="update">更新</button></div></template><script lang="ts">import {  ref,  onMounted,  onUpdated,  onUnmounted,   onBeforeMount,   onBeforeUpdate,  onBeforeUnmount} from "vue"export default {  beforeCreate () {    console.log('beforeCreate()')  },  created () {    console.log('created')  },  beforeMount () {    console.log('beforeMount')  },  mounted () {    console.log('mounted')  },  beforeUpdate () {    console.log('beforeUpdate')  },  updated () {    console.log('updated')  },  beforeUnmount () {    console.log('beforeUnmount')  },  unmounted () {     console.log('unmounted')  },    setup() {    const msg = ref('abc')    const update = () => {      msg.value += '--'    }    onBeforeMount(() => {      console.log('--onBeforeMount')    })    onMounted(() => {      console.log('--onMounted')    })    onBeforeUpdate(() => {      console.log('--onBeforeUpdate')    })    onUpdated(() => {      console.log('--onUpdated')    })    onBeforeUnmount(() => {      console.log('--onBeforeUnmount')    })    onUnmounted(() => {      console.log('--onUnmounted')    })        return {      msg,      update    }  }}</script></code></pre>
<h2 id="7-toRef"><a href="#7-toRef" class="headerlink" title="7) toRef"></a>7) toRef</h2><p>对比<code>ref</code></p>
<ul>
<li><code>toRef</code>为源响应式对象上的某个属性创建一个 ref对象, 二者内部操作的是同一个数据值, <strong>更新时二者是同步更新</strong></li>
<li>ref: 拷贝了一份新的数据值单独操作, 更新时相互不影响</li>
</ul>
<p>应用: 当要将某个prop 的 ref 传递给复合函数时，toRef 很有用</p>
<pre class=" language-vue"><code class="language-vue"><template>  <h2>App</h2>  <p>{{state}}</p>  <p>{{foo}}</p>  <p>{{foo2}}</p>  <button @click="update">更新</button>  <Child :foo="foo"/></template><script lang="ts">import {  reactive,  toRef,  ref,} from 'vue'import Child from './Child.vue'export default {  setup () {    const state = reactive({      foo: 1,      bar: 2    })    const foo = toRef(state, 'foo')    const foo2 = ref(state.foo)    const update = () => {      state.foo++      // foo.value++      // foo2.value++  // foo和state中的数据不会更新    }    return {      state,      foo,      foo2,      update,    }  },  components: {    Child  }}</script><template>  <h2>Child</h2>  <h3>{{foo}}</h3>  <h3>{{length}}</h3></template><script lang="ts">import { computed, defineComponent, Ref, toRef } from 'vue'const component = defineComponent({  props: {    foo: {      type: Number,      require: true    }  },  setup (props, context) {    const length = useFeatureX(toRef(props, 'foo'))    return {      length    }  }})function useFeatureX(foo: Ref) {  const lenth = computed(() => foo.value.length)  return lenth}export default component</script></code></pre>
<h2 id="8-toRefs"><a href="#8-toRefs" class="headerlink" title="8) toRefs"></a>8) toRefs</h2><p>把一个响应式对象转换成普通对象，但该普通对象的每个 property 都是一个 ref</p>
<p>应用: 当从合成函数返回响应式对象时，toRefs 非常有用，这样消费组件就可以在不丢失响应式的情况下对返回的对象进行分解使用</p>
<pre class=" language-vue"><code class="language-vue"><template>  <h2>App</h2>  <h3>foo: {{foo}}</h3>  <h3>bar: {{bar}}</h3>  <h3>foo2: {{foo2}}</h3>  <h3>bar2: {{bar2}}</h3></template><script lang="ts">import { reactive, toRefs } from 'vue'export default {  setup () {    const state = reactive({      foo: 'a',      bar: 'b',    })    const stateAsRefs = toRefs(state)    setTimeout(() => {      state.foo += '++'      state.bar += '++'    }, 2000);    const {foo2, bar2} = useReatureX()    return {      // ...state,      ...stateAsRefs,        //    利用toRefs和对象解构    进行对象属性分散      foo2,       bar2    }  },}function useReatureX() {  const state = reactive({    foo2: 'a',    bar2: 'b',  })  setTimeout(() => {    state.foo2 += '++'    state.bar2 += '++'  }, 2000);  return toRefs(state)}</script></code></pre>
<h2 id="9-customRef"><a href="#9-customRef" class="headerlink" title="9) customRef"></a>9) customRef</h2><p>​        作用：创建一个自定义的 ref，并对其依赖项跟踪和更新触发进行显式控制</p>
<p>需求: 使用 customRef 实现 debounce 的示例</p>
<pre class=" language-vue"><code class="language-vue"><template>  <h2>App</h2>  <input v-model="keyword" placeholder="搜索关键字"/>  <p>{{keyword}}</p></template><script lang="ts">import {  ref,  customRef} from 'vue'export default {  setup () {    const keyword = useDebouncedRef('', 500)    console.log(keyword)    return {      keyword    }  },}/* 实现函数防抖的自定义ref*/function useDebouncedRef<T>(value: T, delay = 200) {  let timeout: number  return customRef((track, trigger) => {    return {      get() {        // 告诉Vue追踪数据        track()        return value      },      set(newValue: T) {        clearTimeout(timeout)        timeout = setTimeout(() => {          value = newValue          // 告诉Vue去触发界面更新          trigger()        }, delay)      }    }  })}</script></code></pre>
<h2 id="10-shallowReactive-与-shallowRef"><a href="#10-shallowReactive-与-shallowRef" class="headerlink" title="10) shallowReactive 与 shallowRef"></a>10) shallowReactive 与 shallowRef</h2><ul>
<li>shallowReactive : 只处理了对象内最外层属性的响应式(也就是浅响应式)</li>
<li>shallowRef: 只处理了value的响应式, 不进行对象的reactive处理</li>
<li>什么时候用浅响应式呢?<ul>
<li>一般情况下使用ref和reactive即可</li>
<li>如果有一个对象数据, 结构比较深, 但变化时只是外层属性变化 ===&gt; shallowReactive</li>
<li>如果有一个对象数据, 后面会产生新的对象来替换 ===&gt; shallowRef</li>
</ul>
</li>
</ul>
<pre class=" language-vue"><code class="language-vue"><template>  <h2>App</h2>  <h3>m1: {{m1}}</h3>  <h3>m2: {{m2}}</h3>  <h3>m3: {{m3}}</h3>  <h3>m4: {{m4}}</h3>  <button @click="update">更新</button></template><script lang="ts">import { reactive, ref, shallowReactive, shallowRef } from 'vue'export default {  setup () {    const m1 = reactive({a: 1, b: {c: 2}})    const m2 = shallowReactive({a: 1, b: {c: 2}})    const m3 = ref({a: 1, b: {c: 2}})    const m4 = shallowRef({a: 1, b: {c: 2}})    const update = () => {      // m1.b.c += 1      // m2.b.c += 1      // m3.value.a += 1      m4.value.a += 1    }    return {      m1,      m2,      m3,      m4,      update,    }  }}</script></code></pre>
<h2 id="11-readonly-与-shallowReadonly"><a href="#11-readonly-与-shallowReadonly" class="headerlink" title="11) readonly 与 shallowReadonly"></a>11) readonly 与 shallowReadonly</h2><ul>
<li>readonly:<ul>
<li>深度只读数据</li>
<li>获取一个对象 (响应式或纯对象) 或 ref 并返回原始代理的只读代理。</li>
<li>只读代理是深层的：访问的任何嵌套 property 也是只读的。</li>
</ul>
</li>
<li>shallowReadonly<ul>
<li>浅只读数据</li>
<li>创建一个代理，使其自身的 property 为只读，但不执行嵌套对象的深度只读转换</li>
</ul>
</li>
<li>应用场景:<ul>
<li>在某些特定情况下, 我们可能不希望对数据进行更新的操作, 那就可以包装生成一个只读代理对象来读取数据, 而不能修改或删除</li>
</ul>
</li>
</ul>
<pre class=" language-vue"><code class="language-vue"><template>  <h2>App</h2>  <h3>{{state}}</h3>  <button @click="update">更新</button></template><script lang="ts">import { reactive, readonly, shallowReadonly } from 'vue'export default {  setup () {    const state = reactive({      a: 1,      b: {        c: 2      }    })    // const rState1 = readonly(state)    const rState2 = shallowReadonly(state)    const update = () => {      // rState1.a++ // error      // rState1.b.c++ // error      // rState2.a++ // error      rState2.b.c++    }        return {      state,      update    }  }}</script></code></pre>
<h2 id="12-toRaw-与-markRaw"><a href="#12-toRaw-与-markRaw" class="headerlink" title="12) toRaw 与 markRaw"></a>12) toRaw 与 markRaw</h2><ul>
<li>toRaw<ul>
<li>返回由 <code>reactive</code> 或 <code>readonly</code> 方法转换成响应式代理的普通对象。</li>
<li>这是一个还原方法，可用于临时读取，访问不会被代理/跟踪，写入时也不会触发界面更新。</li>
</ul>
</li>
<li>markRaw<ul>
<li>标记一个对象，使其永远不会转换为代理。返回对象本身</li>
<li>应用场景:<ul>
<li>有些值不应被设置为响应式的，例如复杂的第三方类实例或 Vue 组件对象。</li>
<li>当渲染具有不可变数据源的大列表时，跳过代理转换可以提高性能。</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre class=" language-vue"><code class="language-vue"><template>  <h2>{{state}}</h2>  <button @click="testToRaw">测试toRaw</button>  <button @click="testMarkRaw">测试markRaw</button></template><script lang="ts">import {  markRaw,  reactive, toRaw,} from 'vue'export default {  setup () {    const state = reactive<any>({      name: 'tom',      age: 25,    })    const testToRaw = () => {      const user = toRaw(state)      user.age++  // 界面不会更新    }    const testMarkRaw = () => {      const likes = ['a', 'b']      // state.likes = likes      state.likes = markRaw(likes) // likes数组就不再是响应式的了      setTimeout(() => {        state.likes[0] += '--'      }, 1000)    }    return {      state,      testToRaw,      testMarkRaw,    }  }}</script></code></pre>
<h2 id="13-响应式数据的判断"><a href="#13-响应式数据的判断" class="headerlink" title="13) 响应式数据的判断"></a>13) 响应式数据的判断</h2><ul>
<li>isRef: 检查一个值是否为一个 ref 对象</li>
<li>isReactive: 检查一个对象是否是由 <code>reactive</code> 创建的响应式代理</li>
<li>isReadonly: 检查一个对象是否是由 <code>readonly</code> 创建的只读代理</li>
<li>isProxy: 检查一个对象是否是由 <code>reactive</code> 或者 <code>readonly</code> 方法创建的代理</li>
</ul>
<h2 id="14-自定义hook函数"><a href="#14-自定义hook函数" class="headerlink" title="14) 自定义hook函数"></a>14) 自定义hook函数</h2><ul>
<li><p>使用Vue3的组合API封装的可复用的功能函数</p>
</li>
<li><p>自定义hook的作用类似于vue2中的mixin技术</p>
</li>
<li><p>自定义Hook的优势: 很清楚复用功能代码的来源, 更清楚易懂</p>
</li>
</ul>
<p>  需求1: 收集用户鼠标点击的页面坐标(hooks/useMousePosition.ts)</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> onUnmounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token comment" spellcheck="true">/* 收集用户鼠标点击的页面坐标*/</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> useMousePosition <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 初始化坐标数据  const x = ref(-1)  const y = ref(-1)  // 用于收集点击事件坐标的函数  const updatePosition = (e: MouseEvent) => {    x.value = e.pageX    y.value = e.pageY  }  // 挂载后绑定点击监听  onMounted(() => {    document.addEventListener('click', updatePosition)  })  // 卸载前解绑点击监听  onUnmounted(() => {    document.removeEventListener('click', updatePosition)  })  return {x, y}}&lt;template>&lt;div>  &lt;h2>x: {{x}}, y: {{y}}&lt;/h2>&lt;/div>&lt;/template>&lt;script>import { ref } from "vue"</span><span class="token comment" spellcheck="true">/* 在组件中引入并使用自定义hook自定义hook的作用类似于vue2中的mixin技术自定义Hook的优势: 很清楚复用功能代码的来源, 更清楚易懂*/</span><span class="token keyword">import</span> useMousePosition <span class="token keyword">from</span> <span class="token string">'./hooks/useMousePosition'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span>x<span class="token punctuation">,</span> y<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMousePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>      x<span class="token punctuation">,</span>      y<span class="token punctuation">,</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>
<ul>
<li><p>利用TS泛型强化类型检查</p>
</li>
<li><p>需求2: 封装发ajax请求的hook函数</p>
<p>hooks/useRequest.ts</p>
</li>
</ul>
<pre class=" language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token comment" spellcheck="true">/* 使用axios发送异步ajax请求*/</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> useUrlLoader<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> result <span class="token operator">=</span> ref<span class="token operator">&lt;</span>T <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> loading <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> errorMsg <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>  axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      loading<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">false</span>      result<span class="token punctuation">.</span>value <span class="token operator">=</span> response<span class="token punctuation">.</span>data    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      loading<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">false</span>      errorMsg<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>message <span class="token operator">||</span> <span class="token string">'未知错误'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token punctuation">{</span>    loading<span class="token punctuation">,</span>    result<span class="token punctuation">,</span>    errorMsg<span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>template<span class="token operator">></span><span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"about"</span><span class="token operator">></span>  <span class="token operator">&lt;</span>h2 v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"loading"</span><span class="token operator">></span>LOADING<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>  <span class="token operator">&lt;</span>h2 v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"errorMsg"</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span>errorMsg<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">&lt;</span>ul v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">></span>    <span class="token operator">&lt;</span>li<span class="token operator">></span>id<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>result<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>    <span class="token operator">&lt;</span>li<span class="token operator">></span>name<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>result<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>    <span class="token operator">&lt;</span>li<span class="token operator">></span>distance<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>result<span class="token punctuation">.</span>distance<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span> <span class="token operator">--</span><span class="token operator">></span>  <span class="token operator">&lt;</span>ul v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"p in result"</span> <span class="token punctuation">:</span>key<span class="token operator">=</span><span class="token string">"p.id"</span><span class="token operator">></span>    <span class="token operator">&lt;</span>li<span class="token operator">></span>id<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>p<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>    <span class="token operator">&lt;</span>li<span class="token operator">></span>title<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>p<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>    <span class="token operator">&lt;</span>li<span class="token operator">></span>price<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>p<span class="token punctuation">.</span>price<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">&lt;</span>img v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"result"</span> <span class="token punctuation">:</span>src<span class="token operator">=</span><span class="token string">"result[0].url"</span> alt<span class="token operator">=</span><span class="token string">""</span><span class="token operator">></span> <span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span><span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">"ts"</span><span class="token operator">></span><span class="token keyword">import</span> <span class="token punctuation">{</span>  watch<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token keyword">import</span> useRequest <span class="token keyword">from</span> <span class="token string">'./hooks/useRequest'</span><span class="token comment" spellcheck="true">// 地址数据接口interface AddressResult {  id: number;  name: string;  distance: string;}// 产品数据接口interface ProductResult {  id: string;  title: string;  price: number;}export default {  setup() {    // const {loading, result, errorMsg} = useRequest&lt;AddressResult>('/data/address.json')    const {loading, result, errorMsg} = useRequest&lt;ProductResult[]>('/data/products.json')    watch(result, () => {      if (result.value) {        console.log(result.value.length) // 有提示      }    })    return {      loading,      result,       errorMsg    }  }}&lt;/script></span></code></pre>
<h2 id><a href="#" class="headerlink" title></a></h2><h1 id="5-Composition-API-对比Option-API"><a href="#5-Composition-API-对比Option-API" class="headerlink" title="5. Composition API 对比Option API"></a>5. Composition API 对比Option API</h1><h2 id="1-Option-API的问题"><a href="#1-Option-API的问题" class="headerlink" title="1) Option API的问题"></a>1) Option API的问题</h2><ul>
<li>在传统的Vue OptionsAPI中，新增或者修改一个需求，就需要分别在data，methods，computed里修改 ，滚动条反复上下移动</li>
</ul>
<img src="./pic/loading.gif" data-original="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f84e4e2c02424d9a99862ade0a2e4114~tplv-k3u1fbpfcp-watermark.image" alt="img" style="zoom:67%;">

<img src="./pic/loading.gif" data-original="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e5ac7e20d1784887a826f6360768a368~tplv-k3u1fbpfcp-watermark.image" alt="img" style="zoom: 67%;">

<h2 id="2-使用Compisition-API"><a href="#2-使用Compisition-API" class="headerlink" title="2) 使用Compisition API"></a>2) 使用Compisition API</h2><p><strong>关注点分离</strong>：我们可以更加优雅的组织我们的代码，函数。让相关功能的代码更加有序的组织在一起</p>
<img src="./pic/loading.gif" data-original="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc0be8211fc54b6c941c036791ba4efe~tplv-k3u1fbpfcp-watermark.image" alt="img" style="zoom:67%;">

<img src="./pic/loading.gif" data-original="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6cc55165c0e34069a75fe36f8712eb80~tplv-k3u1fbpfcp-watermark.image" alt="img" style="zoom:67%;">

<img src="./pic/loading.gif" data-original="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2c421e5392504ecc94c222057dba338a~tplv-k3u1fbpfcp-watermark.image" alt="img" style="zoom:67%;">

<h1 id="6-新组件"><a href="#6-新组件" class="headerlink" title="6. 新组件"></a>6. 新组件</h1><h2 id="1-Fragment-片段"><a href="#1-Fragment-片段" class="headerlink" title="1) Fragment(片段)"></a>1) Fragment(片段)</h2><ul>
<li>在Vue2中: 组件必须有一个根标签</li>
<li>在Vue3中: 组件可以没有根标签, 内部会将多个标签包含在一个Fragment虚拟元素中</li>
<li>好处: 减少标签层级, 减小内存占用</li>
</ul>
<pre class=" language-vue"><code class="language-vue"><template>    <h2>aaaa</h2>    <h2>aaaa</h2></template></code></pre>
<h2 id="2-Teleport-瞬移"><a href="#2-Teleport-瞬移" class="headerlink" title="2) Teleport(瞬移)"></a>2) Teleport(瞬移)</h2><p>Teleport 提供了一种干净的方法, 让组件的html在父组件界面外的特定标签(很可能是body)下插入显示</p>
<pre class=" language-vue"><code class="language-vue">// ModalButton.vue<template>  <button @click="modalOpen = true">      Open full screen modal! (With teleport!)  </button>  <teleport to="body">    <div v-if="modalOpen" class="modal">      <div>        I'm a teleported modal!         (My parent is "body")        <button @click="modalOpen = false">          Close        </button>      </div>    </div>  </teleport></template><script>import { ref } from 'vue'export default {  name: 'modal-button',  setup () {    const modalOpen = ref(false)    return {      modalOpen    }  }}</script><style>.modal {  position: absolute;  top: 0; right: 0; bottom: 0; left: 0;  background-color: rgba(0,0,0,.5);  display: flex;  flex-direction: column;  align-items: center;  justify-content: center;}.modal div {  display: flex;  flex-direction: column;  align-items: center;  justify-content: center;  background-color: white;  width: 300px;  height: 300px;  padding: 5px;}</style></code></pre>
<pre class=" language-vue"><code class="language-vue">// App.vue<template>  <h2>App</h2>  <modal-button></modal-button></template><script lang="ts">import ModalButton from './ModalButton.vue'export default {  setup() {    return {    }  },  components: {    ModalButton  }}</script></code></pre>
<h2 id="3-Suspense-不确定的"><a href="#3-Suspense-不确定的" class="headerlink" title="3) Suspense(不确定的)"></a>3) Suspense(不确定的)</h2><p>它们允许我们的应用程序在等待异步组件时渲染一些后备内容，可以让我们创建一个平滑的用户体验，常与异步组件搭配使用</p>
<pre class=" language-vue"><code class="language-vue"><template>  <Suspense>    <template v-slot:default>      <AsyncComp/>      <!-- <AsyncAddress/> -->    </template>    <template v-slot:fallback>      <h1>LOADING...</h1>    </template>  </Suspense></template><script lang="ts">/* 异步组件 + Suspense组件*/// import AsyncComp from './AsyncComp.vue'import AsyncAddress from './AsyncAddress.vue'import { defineAsyncComponent } from 'vue'const AsyncComp = defineAsyncComponent(() => import('./AsyncComp.vue'))export default {  setup() {    return {         }  },  components: {    AsyncComp,    AsyncAddress  }}</script></code></pre>
<pre class=" language-vue"><code class="language-vue">// AsyncComp.vue<template>  <h2>AsyncComp22</h2>  <p>{{msg}}</p></template><script lang="ts">export default {  name: 'AsyncComp',  setup () {    // return new Promise((resolve, reject) => {    //   setTimeout(() => {    //     resolve({    //       msg: 'abc'    //     })    //   }, 2000)    // })    return {      msg: 'abc'    }  }}</script></code></pre>
<pre class=" language-vue"><code class="language-vue">// AsyncAddress.vue<template><h2>{{data}}</h2></template><script lang="ts">import axios from 'axios'export default {  async setup() {    const result = await axios.get('/data/address.json')    return {      data: result.data    }  }}</script></code></pre>
<h1 id="7-其他新的API"><a href="#7-其他新的API" class="headerlink" title="7. 其他新的API"></a>7. 其他新的API</h1><h2 id="provide-与-inject"><a href="#provide-与-inject" class="headerlink" title="provide 与 inject"></a>provide 与 inject</h2><ul>
<li>provide和inject提供依赖注入，功能类似 2.x 的provide/inject</li>
<li>实现跨多层级组件(祖孙)间通信</li>
</ul>
<pre class=" language-vue"><code class="language-vue"><template>  <h1>父组件</h1>  <p>当前颜色: {{color}}</p>  <button @click="color='red'">红</button>  <button @click="color='yellow'">黄</button>  <button @click="color='blue'">蓝</button>  <hr>  <Son /></template><script lang="ts">import { provide, ref } from 'vue'import Son from './Son.vue'export default {  name: 'ProvideInject',  components: {    Son  },  setup() {    const color = ref('red')    provide('color', color)    return {      color    }  }}</script><template>  <div>    <h2>子组件</h2>    <hr>    <GrandSon />  </div></template><script lang="ts">import GrandSon from './GrandSon.vue'export default {  components: {    GrandSon  },}</script><template>  <h3 :style="{color}">孙子组件: {{color}}</h3></template><script lang="ts">import { inject } from 'vue'export default {  setup() {    const color = inject('color')    return {      color    }  }}</script></code></pre>
<h2 id="全新的全局API"><a href="#全新的全局API" class="headerlink" title="全新的全局API"></a>全新的全局API</h2><ul>
<li>createApp()</li>
<li>defineProperty()</li>
<li>defineAsyncComponent()</li>
<li>nextTick()</li>
</ul>
<h2 id="将原来的全局API转移到应用对象"><a href="#将原来的全局API转移到应用对象" class="headerlink" title="将原来的全局API转移到应用对象"></a>将原来的全局API转移到应用对象</h2><ul>
<li>app.component()</li>
<li>app.config()</li>
<li>app.directive()</li>
<li>app.mount()</li>
<li>app.unmount()</li>
<li>app.use()</li>
</ul>
<h2 id="模板语法变化"><a href="#模板语法变化" class="headerlink" title="模板语法变化"></a>模板语法变化</h2><ul>
<li>v-model的本质变化<ul>
<li>prop：value -&gt; modelValue；</li>
<li>event：input -&gt; update:modelValue；</li>
</ul>
</li>
<li>.sync修改符已移除, 由v-model代替</li>
<li>v-if优先v-for解析</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">liheng</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://necessityovo.github.io/archives/12-vue3.html">https://necessityovo.github.io/archives/12-vue3.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">liheng</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/vue3/">
                                    <span class="chip bg-color">vue3</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="far fa-dot-circle"></i>&nbsp;本篇
            </div>
            <div class="card">
                <a href="/12-vue3.html">
                    <div class="card-image">
                        
                        
                        <img src="./pic/loading.gif" data-original="/medias/featureimages/21.jpg" class="responsive-img" alt="vue3">
                        
                        <span class="card-title">vue3</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            源地址：https://24kcs.github.io/vue3_study/00_%E8%AF%BE%E7%A8%8B%E4%BB%8B%E7%BB%8D.html
1. 认识Vue3特点：
打包大小减少41%,初次渲染快55%, 更新渲
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-07-19
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            liheng
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/vue3/">
                        <span class="chip bg-color">vue3</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/13-linux-bi-ji.html">
                    <div class="card-image">
                        
                        
                        <img src="./pic/loading.gif" data-original="/medias/featureimages/16.jpg" class="responsive-img" alt="Linux笔记">
                        
                        <span class="card-title">Linux笔记</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Linux入门1. Linux介绍
Linux 是一款免费，开源，安全，高效，稳定，处理高斌发很强悍的操作系统
Linux创始人——linux（林纳斯）
Linux主要发行版本


2. Unix与Linux的关系2.1 Unix来源
2.
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-07-19
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            liheng
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%9C%8D%E5%8A%A1%E7%AB%AF/">
                        <span class="chip bg-color">服务端</span>
                    </a>
                    
                    <a href="/tags/Linux/">
                        <span class="chip bg-color">Linux</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2020</span>
            <a href="/about" target="_blank">liheng</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/necessityOVO/necessityOVO.github.io" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2020";
                    var startMonth = "9";
                    var startDate = "10";
                    var startHour = "17";
                    var startMinute = "16";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/necessityOVO" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1061555401@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>

<!-- 


 -->


    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1061555401" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1061555401" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>


<!-- 



 -->
</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/search.xml", 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

<script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var i=n.imageLazyLoadSetting.isSPA,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){i&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,e,a=0;a<r.length;a++)t=r[a],e=void 0,0<=(e=t.getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(n.innerHeight||document.documentElement.clientHeight)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},n.src=i}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body>

</html>
